!function(){"use strict";const t=function(){var t=document,e=t.createTextNode.bind(t);function n(t,e,n){t.style.setProperty(e,n)}function r(t,e){return t.appendChild(e)}function i(e,n,i,s){var a=t.createElement("span");return n&&(a.className=n),i&&(!s&&a.setAttribute("data-"+n,i),a.textContent=i),e&&r(e,a)||a}function s(t,e){return t.getAttribute("data-"+e)}function a(e,n){return e&&0!=e.length?e.nodeName?[e]:[].slice.call(e[0].nodeName?e:(n||t).querySelectorAll(e)):[]}function o(t){for(var e=[];t--;)e[t]=[];return e}function l(t,e){t&&t.some(e)}function u(t){return function(e){return t[e]}}var c={};function d(t,e,n,r){return{by:t,depends:e,key:n,split:r}}function h(t){return function t(e,n,r){var i=r.indexOf(e);if(-1==i)r.unshift(e),l(c[e].depends,(function(n){t(n,e,r)}));else{var s=r.indexOf(n);r.splice(i,1),r.splice(s,0,e)}return r}(t,0,[]).map(u(c))}function p(t){c[t.by]=t}function g(t,n,s,o,u){t.normalize();var c=[],d=document.createDocumentFragment();o&&c.push(t.previousSibling);var h=[];return a(t.childNodes).some((function(t){if(!t.tagName||t.hasChildNodes()){if(t.childNodes&&t.childNodes.length)return h.push(t),void c.push.apply(c,g(t,n,s,o,u));var r=t.wholeText||"",a=r.trim();a.length&&(" "===r[0]&&h.push(e(" ")),l(a.split(s),(function(t,e){e&&u&&h.push(i(d,"whitespace"," ",u));var r=i(d,n,t);c.push(r),h.push(r)}))," "===r[r.length-1]&&h.push(e(" ")))}else h.push(t)})),l(h,(function(t){r(d,t)})),t.innerHTML="",r(t,d),c}var f="words",v=d(f,0,"word",(function(t){return g(t,"word",/\s+/,0,1)})),m="chars",y=d(m,[f],"char",(function(t,e,n){var r=[];return l(n[f],(function(t,n){r.push.apply(r,g(t,"char","",e.whitespace&&n))})),r}));function b(t){var e=(t=t||{}).key;return a(t.target||"[data-splitting]").map((function(r){var i=r["üçå"];if(!t.force&&i)return i;i=r["üçå"]={el:r};var a=h(t.by||s(r,"splitting")||m),o=function(t,e){for(var n in e)t[n]=e[n];return t}({},t);return l(a,(function(t){if(t.split){var s=t.by,a=(e?"-"+e:"")+t.key,u=t.split(r,o,i);a&&(c=r,p=(h="--"+a)+"-index",l(d=u,(function(t,e){Array.isArray(t)?l(t,(function(t){n(t,p,e)})):n(t,p,e)})),n(c,h+"-total",d.length)),i[s]=u,r.classList.add(s)}var c,d,h,p})),r.classList.add("splitting"),i}))}function _(t,e,n){var r=a(e.matching||t.children,t),i={};return l(r,(function(t){var e=Math.round(t[n]);(i[e]||(i[e]=[])).push(t)})),Object.keys(i).map(Number).sort(w).map(u(i))}function w(t,e){return t-e}b.html=function(t){var e=(t=t||{}).target=i();return e.innerHTML=t.content,b(t),e.outerHTML},b.add=p;var x=d("lines",[f],"line",(function(t,e,n){return _(t,{matching:n[f]},"offsetTop")})),A=d("items",0,"item",(function(t,e){return a(e.matching||t.children,t)})),E=d("rows",0,"row",(function(t,e){return _(t,e,"offsetTop")})),$=d("cols",0,"col",(function(t,e){return _(t,e,"offsetLeft")})),N=d("grid",["rows","cols"]),C="layout",L=d(C,0,0,(function(t,e){var o=e.rows=+(e.rows||s(t,"rows")||1),l=e.columns=+(e.columns||s(t,"columns")||1);if(e.image=e.image||s(t,"image")||t.currentSrc||t.src,e.image){var u=a("img",t)[0];e.image=u&&(u.currentSrc||u.src)}e.image&&n(t,"background-image","url("+e.image+")");for(var c=o*l,d=[],h=i(0,"cell-grid");c--;){var p=i(h,"cell");i(p,"cell-inner"),d.push(p)}return r(t,h),d})),M=d("cellRows",[C],"row",(function(t,e,n){var r=e.rows,i=o(r);return l(n[C],(function(t,e,n){i[Math.floor(e/(n.length/r))].push(t)})),i})),k=d("cellColumns",[C],"col",(function(t,e,n){var r=e.columns,i=o(r);return l(n[C],(function(t,e){i[e%r].push(t)})),i})),T=d("cells",["cellRows","cellColumns"],"cell",(function(t,e,n){return n[C]}));return p(v),p(y),p(x),p(A),p(E),p($),p(N),p(L),p(M),p(k),p(T),b}();class e extends window.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}).innerHTML='<style type="text/css">:host {\n  box-sizing: border-box;\n  display: grid;\n  grid-template-columns: 1fr;\n  overflow: hidden;\n}\n\n#display {\n  box-sizing: border-box;\n  display: flex;\n  flex-wrap: wrap;\n  grid-area: 1 / 1 / -1 / -1;\n  align-content: start;\n  align-items: center;\n  column-gap: var(--vari-bio-space, .55ch);\n  row-gap: var(--vari-bio-leading, .14ex);\n  transition: var(--vari-bio-duration, 0) ease;\n  pointer-events: none;\n}\n\n#display span {\n  box-sizing: border-box;\n  background: var(--vari-bio-background);\n  height: var(--vari-bio-height, 3ex);\n  border-radius: var(--vari-bio-radius);\n  transition: var(--vari-bio-duration, 0) ease;\n}\n\n:host([debug]) #display {\n  filter: opacity(20%);\n}\n\n::slotted(*) {\n  grid-area: 1 / 1 / -1 / -1;\n  opacity: 0;\n  pointer-events: none;\n}\n</style><slot id="bios">\x3c!-- used for user input --\x3e</slot>\n<div id="display"></div>\n<slot name="_display"></slot>\n',this._$bios=this.shadowRoot.getElementById("bios"),this._$display=this.shadowRoot.getElementById("display"),this._$bios.addEventListener("slotchange",(()=>this._init("slotchange"))),document.fonts.ready.then((()=>this._init("fontsready")))}_init(t){this.debug&&console.log(t),this.ready=!1;const e=this._$bios.assignedElements();this.querySelectorAll('[slot="_display"]').forEach((t=>t.remove()));const n=e.map(this._measure,this);n.sort(((t,e)=>t.length-e.length)).forEach((([{$elem:t}],e)=>t.dataset.index=e)),this._widths=this._configure(n),this._redactions=this._markings(this._widths),this._progress(),this._display(),this._onReady()}_onReady(){this.ready=!0;const t={max:this.max,value:this.value},e=new CustomEvent("ready",{detail:t});this.dispatchEvent(e)}_markings(t){this._$display.innerHTML="";const e=t.map((t=>{const e=document.createElement("span");this._$display.appendChild(e);const n=new Set(t.map((({start:t})=>t)));return{cumulativeDiff:[...n].reduce(((t,e,n)=>Math.abs(n%0?t+e:t-e)),0),uniqueWidths:n.size===t.length}})),n=e.filter((({uniqueWidths:t})=>Boolean(t))),[r]=n.sort(((t,e)=>e.cumulativeDiff-t.cumulativeDiff))||n,i=e.indexOf(r);return this._$display.children[i].addEventListener("transitionend",(()=>this._display())),[...this._$display.children]}_configure(t){return t.reduceRight(((e,n,r)=>{if(!Array.isArray(e))return n.map((({width:e})=>t.map((()=>({start:e,end:e})))));const i=t[r+1],s=i.slice().sort(((t,e)=>t.characters-e.characters)).slice(0,i.length-n.length),a=n.slice();return e.forEach(((t,e)=>{const n=i[e];t[r]={start:0,end:0},t[r+1]?.start&&(t[r].start=n&&s.includes(n)?0:a.shift()?.width||0,t[r].end=t[r+1].start)})),e}),null)}_measure(e){const n=e.cloneNode(!0),[{el:r,words:i}]=t({target:n,by:"words"});r.setAttribute("slot","_display"),this.appendChild(r),r.style.position="absolute";const s=i.map((t=>{const{width:n}=t.getBoundingClientRect();return{characters:t.textContent.length,width:n,$elem:e}}));return this.debug||r.remove(),s}static get observedAttributes(){return["value"]}attributeChangedCallback(t){"value"===t&&this._progress()}_parse(t){const e=Math.floor(t);return{index:e,progress:parseFloat(t)-e}}_display(){const{index:t,progress:e}=this._parse(this.value);this.querySelectorAll("[data-index]:not(.words)").forEach((n=>{!e&n.dataset.index==t&&(n.style.opacity=1,n.style.pointerEvents="initial")})),this.debug||(this._$display.style.opacity=Math.ceil(e))}_reset(){this.querySelectorAll("[data-index]").forEach((t=>{t.style.removeProperty("opacity"),t.style.removeProperty("pointer-events")})),this._$display.style.opacity=1}_progress(){const{index:t,progress:e}=this._parse(this.value);Array.isArray(this._redactions)&&(this._reset(),this.style.setProperty("--vari-bio-progress",e.toFixed(3)),this._redactions.forEach(((e,n)=>{const{start:r=0,end:i=0}=this._widths[n][t];e.style.setProperty("width",`calc(${r}px - ((${r}px - ${i}px) * var(--vari-bio-progress, 0)))`),e.style.removeProperty("margin-inline-start"),r||e.style.setProperty("margin-inline-start","calc((var(--vari-bio-space, .55ch) * -1) * (1 - var(--vari-bio-progress, 0)))"),i||e.style.setProperty("margin-inline-start","calc((var(--vari-bio-space, .55ch) * -1))")})))}get value(){return parseFloat(this.getAttribute("value"),10)||0}set value(t){isNaN(t)?this.removeAttribute("value"):this.setAttribute("value",t)}get max(){return this._$bios.assignedElements().length-1}get debug(){return this.hasAttribute("debug")}set debug(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}}window.customElements.define("vari-bio",e)}();
